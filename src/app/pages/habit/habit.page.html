<ion-content>
  <ion-grid>
    <ion-row>
      <ion-col size="auto">
        <app-menu></app-menu>
      </ion-col>

      <ion-col>
        <main>
          <app-header></app-header>
          <section>
            @if (showHabitModal) {
            <app-create-habit-modal (close)="closeModal()" @fadeInOut />
            } @if (showListModal) {
            <app-create-list-modal (close)="closeModal()" @fadeInOut />
            }

            <div class="create-cards">
              <app-create-card
                [title]="'Novo Hábito'"
                [imagePath]="'./assets/icon/post_add_250dp_FFFFFF.png'"
                (click)="openHabitModal()"
              >
              </app-create-card>
              <app-create-card
                [title]="'Nova Lista'"
                [imagePath]="'./assets/icon/create_new_folder_50dp_FFFFFF.png'"
                (click)="openListModal()"
              >
              </app-create-card>
            </div>
          </section>
          <section>
            <div class="habit-container">
              <div class="habit-header">
                <h2>Lista de Hábitos</h2>
                <button class="filter">
                  <img src="./assets/icon/tune_100dp_434343.png" alt="" />
                  <p>Editar Listas</p>
                </button>
              </div>
              <div class="habit-toolbar">
                <nav class="habit-list-tabs">
                  @for (tab of tabs; track tab.id) {
                  <button
                    [class.active]="activeTab === tab.name"
                    (click)="setActive(tab.name)"
                  >
                    {{ tab.name }}
                  </button>
                  @if (tab.id) {
                  <!-- <button (click)="openEditModal(tab)">Editar</button> -->
                  } }
                  <button class="new-list" (click)="openListModal()">
                    + Nova lista
                  </button>
                </nav>
                <div class="search-bar">
                  <img
                    src="./assets/icon/search_100dp_434343.png"
                    alt=""
                    width="25px"
                  />
                  <input
                    type="text"
                    placeholder="Buscar hábito... "
                    [(ngModel)]="searchText"
                    (ngModelChange)="onSearchChange()"
                  />
                </div>
              </div>

              <div class="habit-list-cards">
                <div class="list-header">
                  <div
                    class="header-item name"
                    [class.active]="sortState.key === 'name'"
                    (click)="sortBy('name')"
                  >
                    Nome
                    <img
                      src="./assets/icon/arrow.svg"
                      alt=""
                      class="sort-icon"
                      [class.rotated]="sortState.key === 'name' && sortState.direction === 'asc'"
                      [class.visible]="sortState.key === 'name'"
                      width="12px"
                      height="12px"
                    />
                  </div>
                  <div
                    class="header-item category"
                    [class.active]="sortState.key === 'category'"
                    (click)="sortBy('category')"
                  >
                    Categoria
                    <img
                      src="./assets/icon/arrow.svg"
                      alt=""
                      class="sort-icon"
                      [class.rotated]="sortState.key === 'category' && sortState.direction === 'asc'"
                      [class.visible]="sortState.key === 'category'"
                      width="12px"
                      height="12px"
                    />
                  </div>
                  <div
                    class="header-item status"
                    [class.active]="sortState.key === 'state'"
                    (click)="sortBy('state')"
                  >
                    Status
                    <img
                      src="./assets/icon/arrow.svg"
                      alt=""
                      class="sort-icon"
                      [class.rotated]="sortState.key === 'state' && sortState.direction === 'asc'"
                      [class.visible]="sortState.key === 'state'"
                      width="12px"
                      height="12px"
                    />
                  </div>
                  <div
                    class="header-item priority"
                    [class.active]="sortState.key === 'priority'"
                    (click)="sortBy('priority')"
                  >
                    Prioridade
                    <img
                      src="./assets/icon/arrow.svg"
                      alt=""
                      class="sort-icon"
                      [class.rotated]="sortState.key === 'priority' && sortState.direction === 'asc'"
                      [class.visible]="sortState.key === 'priority'"
                      width="12px"
                      height="12px"
                    />
                  </div>
                </div>
                @if (!loading) { @if (activeTab === 'Ver tudo') { @if
                (hasHabits) {
                <ul class="habit-list">
                  @for (habit of filteredHabits; track habit.id) {
                  <li>
                    <app-habit-card
                      (delete)="deleteHabit($event)"
                      (mark)="completeHabit($event)"
                      [habit]="habit"
                      style="width: 100%"
                    ></app-habit-card>
                  </li>
                  }
                </ul>
                } @else {
                <div class="no-habits">
                  <p>Você ainda não criou hábitos.</p>
                </div>
                }} @if (activeTab !== 'Ver tudo') { @if (hasHabits) {
                <ul class="habit-list">
                  @for (habit of filteredHabits; track habit.id) {
                  <li>
                    <app-habit-card
                      (delete)="deleteHabit($event)"
                      (mark)="completeHabit($event)"
                      [habit]="habit"
                      style="width: 100%"
                    ></app-habit-card>
                  </li>
                  }
                </ul>
                } @else {
                <div class="no-habits">
                  <p>Não há hábitos nesta lista.</p>
                </div>
                }}}
              </div>
            </div>
          </section>
        </main>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>
<!-- 
<div class="modal-backdrop" *ngIf="editingList">
  <div class="modal">
    <h2>Editar Lista</h2>

    <label>
      Nome:
      <input type="text" [(ngModel)]="editingListName" />
    </label>

    <div class="habit-selection">
      <h3>Selecionar Hábitos</h3>
      <ul>
        @for (habit of allHabits; track habit.id) {
        <li>
          <input
            type="checkbox"
            [checked]="selectedHabits.has(habit.id)"
            (change)="toggleHabitSelection(habit.id)"
          />
          {{ habit.name }}
        </li>
        }
      </ul>
    </div>

    <div class="modal-buttons">
      <button (click)="saveListChanges()">Salvar</button>
      <button (click)="cancelEdit()">Cancelar</button>
    </div>
  </div>
</div> -->
