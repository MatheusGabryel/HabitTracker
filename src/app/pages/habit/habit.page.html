<ion-content>
  <div class="app-container">
    <app-menu></app-menu>

    <div class="main-container">
      <app-header></app-header>

      <main class="page-content">
        <section>
          @if (showHabitModal) {
          <app-create-habit-modal
            (close)="closeModal()"
            @fadeInOut
          ></app-create-habit-modal>
          } @if (showListModal) {
          <app-create-list-modal
            (close)="closeModal()"
            @fadeInOut
          ></app-create-list-modal>
          } @if (showEditHabitModal && habitToEdit !== null) {
          <app-edit-habit-modal
            [habitToEdit]="habitToEdit"
            (close)="closeModal()"
            @fadeInOut
          ></app-edit-habit-modal>
          } @if (showEditListsModal) {
          <app-edit-lists-modal
            (close)="closeModal()"
            @fadeInOut
            (delete)="deleteList($event)"
            [lists]="lists"
            (toggle)="toggleVisibility($event)"
          ></app-edit-lists-modal>
          }

          <div class="create-cards">
            <app-create-card
              [title]="'Novo Hábito'"
              [imagePath]="'./assets/icon/post_add_250dp_FFFFFF.png'"
              (click)="openHabitModal()"
            ></app-create-card>

            <app-create-card
              [title]="'Nova Lista'"
              [imagePath]="'./assets/icon/create_new_folder_50dp_FFFFFF.png'"
              (click)="openListModal()"
            ></app-create-card>
          </div>
        </section>

        <section>
          <div class="habit-container">
            <div class="habit-header">
              <h2>Lista de Hábitos</h2>
              <button class="filter" (click)="openEditListsModal()">
                <img src="./assets/icon/tune_100dp_434343.png" alt="" />
                <p>Editar Listas</p>
              </button>
            </div>

            <div class="habit-toolbar">
              <nav class="habit-list-tabs desktop-only">
                @for (tab of tabs; track tab.id) {
                <button
                  [class.active]="activeTab === tab.name"
                  (click)="setActive(tab.name)"
                >
                  {{ tab.name }}
                </button>
                }
                <button class="new-list" (click)="openListModal()">
                  + Nova lista
                </button>
              </nav>

              <swiper-container
                class="habit-list-tabs mobile-only"
                slides-per-view="auto"
                space-between="10"
                free-mode="true"
              >
                @for (tab of tabs; track tab.id) {
                <swiper-slide>
                  <button
                    [class.active]="activeTab === tab.name"
                    (click)="setActive(tab.name)"
                  >
                    {{ tab.name }}
                  </button>
                </swiper-slide>
                }
                <swiper-slide>
                  <button class="new-list" (click)="openListModal()">
                    + Nova lista
                  </button>
                </swiper-slide>
              </swiper-container>

              <div class="search-bar">
                <img
                  src="./assets/icon/search_100dp_434343.png"
                  alt=""
                  width="25px"
                />
                <input
                  type="text"
                  placeholder="Buscar hábito... "
                  [(ngModel)]="searchText"
                  (ngModelChange)="onSearchChange()"
                />
              </div>
            </div>

            <div class="habit-list-cards">
              <div class="list-header">
                <div class="icon-col"></div>
                @for (header of tableHeaders; track header.key) {
                <div
                  class="header-item {{ header.class }}"
                  [class.active]="sortState.key === header.key"
                  (click)="sortBy(header.key)"
                >
                  {{ header.label }}
                  <img
                    src="./assets/icon/arrow.svg"
                    alt=""
                    class="sort-icon"
                    [class.rotated]="
                        sortState.key === header.key && sortState.direction === 'asc'
                      "
                    [class.visible]="sortState.key === header.key"
                    width="12px"
                    height="12px"
                  />
                </div>
                }
                <div class="actions-col"></div>
              </div>

              @if (!loading) { @if (hasHabits) {
              <ul class="habit-list">
                @for (habit of filteredHabits; track habit.id) {
                <li>
                  <app-habit-card
                    (delete)="deleteHabit($event)"
                    [habit]="habit"
                    (open)="openEditHabitModal($event)"
                    style="width: 100%"
                  ></app-habit-card>
                </li>
                }
              </ul>
              } @else {
              <div class="empty-state">
                <img
                  src="./assets/icon/post_add_250dp_FFFFFF.png"
                  alt="Nenhum hábito"
                  class="empty-icon"
                />
                @if (activeTab === 'Ver tudo') {
                <p>Você ainda não criou nenhum hábito</p>
                <p class="empty-subtitle">Comece criando seu primeiro hábito para começar sua jornada!</p>
                } @else {
                <p>Não há hábitos nesta lista</p>
                <p class="empty-subtitle">Adicione hábitos a esta categoria ou selecione outra lista.</p>
                }
                <button class="create-button" (click)="openHabitModal()">Criar Hábito</button>
              </div>
              } }
            </div>
          </div>
        </section>
      </main>
    </div>
  </div>
</ion-content>
